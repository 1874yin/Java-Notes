# 数据库优化

#### 数据库优化有很多层次，包括：

1. 语句上的优化：尽量不要使用多表查询，尽量不要频繁的使用各种统计查询，如果需要，使用子查询来代替。
2. 数据库的优化：在查询上优化，使用索引。但是一旦使用了索引，就不能频繁地进行修改。空间换时间，时间换空间。
3. 当存在多个 RPC 业务端的时候，可以考虑进行垂直拆库的做法，按照功能进行拆分。
4. 分库无法解决问题时，考虑数据库的水平拆分。
5. 需要保证强大的查询性能，那就引入搜索引擎的概念进行分词处理。

#### NoSQL 场景

在现在的开发领域中，NoSQL 可以实现文档存储（BSON，JSON）、缓存存储、图像缓存（图像搜索）。

#### 数据库设计

单数据库的设计无法应对高数据量的业务，所以需要进行拆库拆表。

**水平拆分**：假如订单表的数据量很大，于是将这些订单表拆分为十个数据库的表，每个数据库只存 10% 的订单。

**垂直拆分**：将数据表由一张表拆分为多张表，将字段分开。

#### 缓存

把一些常用的数据直接放在内存里面，不需要通过磁盘读取，这样就避免了硬盘的性能障碍。

#### ACID 原则

ACID 原则是关系型数据库的事务机制需要遵守的原则，即原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）。这四种原则保证在事务过程当中数据的正确性。

- 原子性（A）

  一个事务的所有系列操作步骤被看成一个动作，所有的步骤要么全部完成，要么一个也不会完成。如果在事务过程中发生错误，则会回滚到事务开始前的状态，将要被改变的数据库记录不会被改变。

- 一致性（C）

  在事务开始之前和事务结束以后，数据库的完整性约束没有被破坏。即数据库事务不能破坏关系数据的完整性及业务逻辑上的一致性。

- 隔离性（I）

  主要用于实现并发控制，隔离能够确保并发执行的事务按顺序一个接一个地执行。通过隔离，一个未完成事务不会影响另外一个未完成事务。

- 持久性（D）

  一旦一个事务被提交，它应该持久保存，不会因为与其他操作冲突而取消这个事务。

在开发中可能见到的事务处理模式有三种：

- 第一种：JDBC 的原始处理，只提供有：commit(), rollback(), setAutoCommit()
- 第二种：容器控制事务，使用 jta 组件，一般不用
- 第三种：Spring 的事务控制，在 Spring 里面针对于事务的操作有了一些自己的逻辑性的提升，使用的是原始的 JDBC 处理。